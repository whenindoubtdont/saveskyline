let contentCache=null;function getByPath(e,t){if(t&&!t.startsWith("_"))return t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}function escapeHtml(e){if("string"!=typeof e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function applyBold(e){if("string"!=typeof e)return"";return escapeHtml(e).replace(/\*\*([^*]+)\*\*/g,(e,t)=>"<strong>"+t+"</strong>")}function applyContent(e){e&&(contentCache=e,document.title=e.meta?.title||document.title,document.querySelectorAll(".supervisors-link").forEach(t=>{e.meta?.supervisorsUrl&&(t.href=e.meta.supervisorsUrl)}),document.querySelectorAll("[data-content]").forEach(t=>{const n=t.getAttribute("data-content"),o=getByPath(e,n);if(void 0===o)return;const a=t.getAttribute("data-content-bold"),i=a?getByPath(e,a):null;if("IMG"!==t.tagName)if("action.emailTemplate"!==n)if("threat.heading"!==n)if("threat.paragraph1"!==n)if("park.closing"!==n||void 0===i){if("action.footerLinkText"===n&&e.meta?.supervisorsUrl){const n=e.meta.supervisorsUrl.replace(/"/g,"&quot;"),a=escapeHtml(o);return void(t.innerHTML=a.replace("napacounty.gov",'<a href="'+n+'" target="_blank" class="underline hover:text-emerald-400">napacounty.gov</a>'))}"string"==typeof o&&o.includes("**")?t.innerHTML=applyBold(o):t.textContent=o}else t.innerHTML=escapeHtml(o)+' <span class="text-emerald-400 font-bold">'+escapeHtml(i)+"</span>";else t.innerHTML=applyBold(o);else t.innerHTML=o.replace(/\n/g,"<br>");else t.textContent=o;else t.alt=o}))}function populateContacts(e){const t=Array.isArray(e)?e:[],n=document.getElementById("contacts");n&&(n.innerHTML="",t.forEach(e=>{const t=document.createElement("div");t.className="bg-stone-900 hover:bg-stone-800 border border-stone-700 hover:border-emerald-600 rounded-2xl p-5 transition cursor-pointer group",t.dataset.email=e.email||"",t.innerHTML=`\n            <div class="flex justify-between items-start">\n                <div>\n                    <div class="font-semibold text-emerald-300">${escapeHtml(e.name||"")}</div>\n                    <div class="text-xs text-stone-400 font-mono">${escapeHtml(e.email||"")}</div>\n                </div>\n                <button type="button" class="copy-contact-email bg-emerald-900 hover:bg-emerald-700 text-emerald-100 px-4 py-2 rounded-xl text-xs flex items-center gap-2 transition">\n                    <i class="fas fa-copy"></i> COPY\n                </button>\n            </div>\n        `,t.onclick=e=>{e.target.closest("button")||copyEmail(t.dataset.email)},t.querySelector(".copy-contact-email").onclick=e=>{e.stopPropagation(),copyEmail(t.dataset.email)},n.appendChild(t)}))}function populateSources(e){const t=Array.isArray(e)?e:[],n=document.getElementById("sources-list");n&&(n.innerHTML="",t.forEach(e=>{const t=document.createElement("a");t.href=e.url||"#",t.target="_blank",t.rel="noopener noreferrer",t.className="block bg-stone-950 hover:bg-stone-800 border border-stone-800 hover:border-emerald-600 rounded-2xl p-5 transition group",t.innerHTML=`\n            <div class="flex justify-between items-start gap-4">\n                <div class="min-w-0">\n                    <div class="font-semibold text-emerald-300 group-hover:text-emerald-200 transition">${escapeHtml(e.name||"")}</div>\n                    <div class="text-sm text-stone-400 mt-1">${escapeHtml(e.description||"")}</div>\n                </div>\n                <div class="text-stone-500 group-hover:text-emerald-400 transition flex-shrink-0 mt-1">\n                    <i class="fas fa-external-link-alt"></i>\n                </div>\n            </div>\n        `,n.appendChild(t)}))}function showToast(e){const t=document.createElement("div");t.className="fixed bottom-8 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-3 z-50",t.innerHTML='<i class="fas fa-check"></i> '+escapeHtml(e),document.body.appendChild(t),setTimeout(()=>t.remove(),2500)}function copyEmail(e){navigator.clipboard.writeText(e).then(()=>{showToast(contentCache?.toasts?.emailCopied||"Email copied — paste & send")}).catch(()=>{showToast("Could not copy — try selecting the email manually")})}function getTemplateSubjectAndBody(){const e=document.getElementById("template"),t=e&&e.innerText?e.innerText.trim():"",n=t.match(/^Subject:\s*(.+?)(?:\n|$)/im),o=n?n[1].trim():"Save Skyline Park",a=t.indexOf("\n\n");return{subject:o,body:a>=0?t.slice(a+2).trim():t}}const TRUNCATE_NOTE="\n\n[Template shortened for this link; use Copy for full text.]",MAX_BODY_RAW=700;function buildComposeUrls(e,t){let n=e||"",o=t||"";o.length>700&&(o=o.slice(0,700)+TRUNCATE_NOTE);const a=encodeURIComponent(n),i=encodeURIComponent(o);return{gmail:"https://mail.google.com/mail/?view=cm&fs=1&su="+a+"&body="+i,yahoo:"https://compose.mail.yahoo.com/?subject="+a+"&body="+i,outlook:"https://outlook.live.com/mail/0/deeplink/compose?subject="+a+"&body="+i,mailto:"mailto:?subject="+a+"&body="+i}}function openCompose(e){const{subject:t,body:n}=getTemplateSubjectAndBody(),o=buildComposeUrls(t,n)[e];if(o)if("mailto"===e){const e=document.createElement("a");e.href=o,e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),e.remove()}else window.open(o,"_blank","noopener,noreferrer")}function copyTemplate(){const e=document.getElementById("template"),t=document.getElementById("copy-template-btn"),n=e?e.innerText:"";function o(){if(!t)return;const e=t.querySelector("span"),n=t.querySelector("i");e&&(e.textContent=e.dataset.orig||"COPY FULL EMAIL"),n&&(n.className="fas fa-copy"),t.disabled=!1}navigator.clipboard.writeText(n).then(()=>{if(showToast(contentCache?.toasts?.templateCopied||"Full template copied. Open your mail app and paste."),t){const e=t.querySelector("span"),n=t.querySelector("i");e&&(e.dataset.orig=e.dataset.orig||e.textContent,e.textContent="Copied!"),n&&(n.className="fas fa-check"),t.disabled=!0,setTimeout(o,2e3)}}).catch(()=>{showToast("Could not copy — try selecting the text manually"),o()})}function getShareUrl(){const e=document.querySelector('link[rel="canonical"]');return e&&e.href?e.href:contentCache?.meta?.siteUrl?contentCache.meta.siteUrl:window.location.href}function getShareText(){return contentCache?.meta?.shareText||"Skyline Wilderness Park in Napa is under threat. Take action to save the park."}function sharePage(){const e=getShareUrl(),t=document.title,n=getShareText();navigator.share?navigator.share({title:t,text:n,url:e}).catch(()=>{copyLinkFallback(e)}):copyLinkFallback(e)}function copyLinkFallback(e){navigator.clipboard.writeText(e).then(()=>{showToast(contentCache?.toasts?.linkCopied||"Link copied — paste to share")}).catch(()=>{showToast("Could not copy link")})}function initShareButtons(){document.querySelectorAll("#nav-share-btn, #action-share-btn").forEach(e=>{e&&e.addEventListener("click",sharePage)})}function initFooterShareLinks(){const e=encodeURIComponent(getShareUrl()),t=encodeURIComponent(getShareText()),n=document.getElementById("footer-share-x"),o=document.getElementById("footer-share-facebook");n&&(n.href="https://twitter.com/intent/tweet?url="+e+"&text="+t),o&&(o.href="https://www.facebook.com/sharer/sharer.php?u="+e);const a=document.getElementById("forward-neighbor-link");a&&(a.href="mailto:?subject="+encodeURIComponent("Please read this about Skyline Park")+"&body="+encodeURIComponent(getShareUrl()))}function initAudioPlayer(){const e=document.getElementById("podcast-audio"),t=document.getElementById("audio-player"),n=document.getElementById("audio-prompt"),o=document.getElementById("audio-play-btn"),a=document.getElementById("audio-icon"),i=document.getElementById("audio-progress-bar"),s=document.getElementById("audio-progress"),r=document.getElementById("audio-current"),l=document.getElementById("audio-duration"),c=document.getElementById("audio-close-btn");function d(e){const t=Math.floor(e/60),n=Math.floor(e%60);return t+":"+(n<10?"0":"")+n}e&&t&&n&&(n.addEventListener("click",()=>{n.classList.add("hidden"),t.classList.remove("translate-y-full"),e.play()}),o.addEventListener("click",()=>{e.paused?e.play():e.pause()}),e.addEventListener("play",()=>{a.className="fas fa-pause text-sm"}),e.addEventListener("pause",()=>{a.className="fas fa-play text-sm"}),e.addEventListener("loadedmetadata",()=>{l.textContent=d(e.duration)}),e.addEventListener("timeupdate",()=>{if(!e.duration)return;const t=e.currentTime/e.duration*100;s.style.width=t+"%",r.textContent=d(e.currentTime)}),e.addEventListener("ended",()=>{a.className="fas fa-play text-sm",s.style.width="0%",r.textContent="0:00"}),i.addEventListener("click",t=>{if(!e.duration)return;const n=i.getBoundingClientRect(),o=(t.clientX-n.left)/n.width;e.currentTime=o*e.duration}),c.addEventListener("click",()=>{e.pause(),t.classList.add("translate-y-full"),n.classList.remove("hidden")}))}function initDistrictFinder(){var e=document.getElementById("district-finder"),t=document.getElementById("district-address"),n=document.getElementById("district-submit"),o=document.getElementById("district-result"),a=document.getElementById("district-error");if(e&&t&&n){var i={1:{name:"Joelle Gallagher",phone:"(707) 253-4828",tel:"+17072534828"},2:{name:"Liz Alessio",phone:"(707) 259-8276",tel:"+17072598276"},3:{name:"Anne Cottrell",phone:"(707) 253-4827",tel:"+17072534827"},4:{name:"Amber Manfree",phone:"(707) 259-8278",tel:"+17072598278"},5:{name:"Belia Ramos",phone:"(707) 259-8277",tel:"+17072598277"}};n.addEventListener("click",l),t.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),l())})}function s(e){n.disabled=e,n.innerHTML=e?'<i class="fas fa-spinner fa-spin"></i> Looking up…':'<i class="fas fa-search"></i> Find My Supervisor'}function r(e){o.classList.add("hidden"),a.textContent=e,a.classList.remove("hidden")}function l(){var e=t.value.trim();e&&(/napa/i.test(e)||(e+=", Napa, CA"),s(!0),a.classList.add("hidden"),o.classList.add("hidden"),fetch("https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?SingleLine="+encodeURIComponent(e)+"&outFields=Match_addr&maxLocations=1&f=json").then(function(e){return e.json()}).then(function(e){var t=e.candidates&&e.candidates[0];if(!t||t.score<70)throw new Error("not_found");var n=t.location.x,s=t.location.y,r=t.attributes&&t.attributes.Match_addr;return fetch("https://gis.napacounty.gov/arcgis/rest/services/Hosted/Supervisor_Districts/FeatureServer/0/query?geometry="+n+","+s+"&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=sup_district,supervisor&returnGeometry=false&f=json").then(function(e){return e.json()}).then(function(e){var t=e.features&&e.features[0];if(!t)throw new Error("no_district");!function(e,t){a.classList.add("hidden");var n=i[e]||{name:"Supervisor",phone:"(707) 253-4580",tel:"+17072534580"};o.innerHTML='<div class="bg-emerald-900/40 border border-emerald-700 rounded-xl p-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"><div><div class="text-emerald-400 text-xs font-mono mb-1">YOUR SUPERVISOR</div><div class="text-white text-lg font-bold">'+escapeHtml(n.name)+'</div><div class="text-stone-400 text-sm">District '+escapeHtml(e)+"</div>"+(t?'<div class="text-stone-500 text-xs mt-1">'+escapeHtml(t)+"</div>":"")+'</div><a href="tel:'+n.tel+'" class="inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white px-5 py-3 rounded-xl font-semibold text-sm transition min-h-[44px]"><i class="fas fa-phone"></i> Call '+escapeHtml(n.phone)+"</a></div></div>",o.classList.remove("hidden"),document.querySelectorAll("#supervisor-list [data-district]").forEach(function(t){t.dataset.district===e?t.classList.add("ring-1","ring-emerald-500"):t.classList.remove("ring-1","ring-emerald-500")})}(t.attributes.sup_district,r)})}).catch(function(e){"not_found"===e.message?r('Address not found. Try including your street number and "Napa" (e.g. "1234 Main St, Napa").'):"no_district"===e.message?r("That address doesn't appear to be in a Napa County supervisor district. Try a different address."):r("Lookup failed — check your connection and try again, or call the Clerk at (707) 253-4580.")}).finally(function(){s(!1)}))}}function initMobileMenu(){const e=document.getElementById("nav-menu-btn"),t=document.getElementById("nav-menu"),n=e?e.querySelector("i"):null;function o(o){o?t.classList.add("is-open"):t.classList.remove("is-open"),t.setAttribute("aria-hidden",!o),e.setAttribute("aria-expanded",o),e.setAttribute("aria-label",o?"Close menu":"Open menu"),n&&(n.className=o?"fas fa-times text-xl":"fas fa-bars text-xl")}e&&t&&(e.addEventListener("click",()=>{o(!t.classList.contains("is-open"))}),t.querySelectorAll(".mobile-nav-link").forEach(e=>{e.addEventListener("click",()=>o(!1))}))}function initSectionReveal(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return void document.querySelectorAll(".section-reveal").forEach(e=>e.classList.add("is-visible"));const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{rootMargin:"0px 0px -60px 0px",threshold:.05});document.querySelectorAll(".section-reveal").forEach(t=>e.observe(t))}function initBackToTop(){const e=document.getElementById("back-to-top");if(!e)return;const t=document.querySelector("header#main"),n=t?t.offsetTop+t.offsetHeight:600;function o(){window.scrollY>.8*n?e.classList.add("is-visible"):e.classList.remove("is-visible")}window.addEventListener("scroll",o,{passive:!0}),o()}window.onload=()=>{fetch("content.json").then(e=>e.ok?e.json():Promise.reject()).then(e=>{applyContent(e),populateContacts(e.contacts),populateSources(e.sources)}).catch(()=>{populateContacts([{name:"Napa Valley Register",email:"jennifer.huffman@napanews.com"},{name:"KQED Assignment",email:"assignmentdesk@kqed.org"},{name:"California Globe",email:"katy@californiaglobe.com"},{name:"California Globe",email:"evan@californiaglobe.com"},{name:"News Netter",email:"newsnetter3@gmail.com"},{name:"KPIX CBS",email:"kpixnewsassign.editors@cbs.com"},{name:"KGO 7 On Your Side",email:"7onYourSide@kgo-tv.com"},{name:"FOX News Tips",email:"newstips@fox.com"},{name:"KRON 4",email:"BreakingNews@kron4.com"},{name:"KCRA",email:"news@kcra.com"}])}),initShareButtons(),initFooterShareLinks(),initAudioPlayer(),initMobileMenu(),initSectionReveal(),initBackToTop(),initDistrictFinder()};